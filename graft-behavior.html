<link rel="import" href="../polymer/polymer.html">
<script>
(function() {
'use strict';

/** @polymerBehavior D2L.PolymerBehaviors.NavigationGraftBehavior */
var NavigationGraftBehavior = {
	properties: {
		graftLocation: String,
		_partialled: {
			type: Boolean,
			value: false
		}
	},
	findPageFunc: function(name) {

		var parts = name.split('.');
		var func = window;

		for (var i=0; i<parts.length; i++) {
			func = func[parts[i]];
			if (!func) {
				break;
			}
		}

		return func;

	},
	graft: function(id) {

		if (this._partialled) {
			return;
		}
		this._partialled = true;

		var partialRender = this.findPageFunc('D2L.LP.Web.UI.Html.PartialRendering.PartialRender');
		var connectPartial = this.findPageFunc('D2L.LP.Web.UI.Rpc.ConnectPartial');
		if (!partialRender || !connectPartial) {
			// TODO: deal with this more gracefully
			return;
		}

		var placeholderId = { GetValue: function() { return id; } };
		var location = { GetUrl: function() { return this.graftLocation; }.bind(this) };
		partialRender(
			placeholderId,
			function() {
				return connectPartial(placeholderId, 'GET', location);
			}
		);

	}
};

window.D2L = window.D2L || {};
window.D2L.PolymerBehaviors = window.D2L.PolymerBehaviors || {};
/** @polymerBehavior */
window.D2L.PolymerBehaviors.NavigationGraftBehavior = [NavigationGraftBehavior]
})();
</script>
