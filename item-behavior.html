<link rel="import" href="../polymer/polymer.html">
<script>
(function() {
'use strict';

/** @polymerBehavior D2L.PolymerBehaviors.NavigationItemBehavior */
var NavigationItemBehavior = {
	properties: {
		item: Object
	},
	hostAttributes: {
		role: 'listitem'
	},
	getHref: function() {
		var href = undefined;
		if (this.item.class.indexOf('item') > -1) {
			if (this.item.class.indexOf('link') > -1) {
				this.item.links.forEach(function(l) {
					if (l.rel.indexOf('self') > -1) {
						href = l.href;
					}
				});
			}
		}
		return href;
	},
	getText: function() {
		if (this.item.class.indexOf('item') > -1) {
			return this.item.properties.text;
		} else if (this.item.class.indexOf('action') > -1) {
			return this.item.title;
		}
	},
	onClick: function() {
		if (this.item.class.indexOf('popup') > -1) {
			this.onClickPopup();
		} else if (this.item.class.indexOf('action') > -1) {
			this.onClickAction();
		}
	},
	onClickPopup: function() {

		var features = '';
		if ( this.item.properties.Width > 0 ) {
			features += 'width=' + this.item.properties.Width + ',';
		}
		if( this.item.properties.Height > 0 ) {
			features += 'height=' + this.item.properties.Height + ',';
		}

		features += 'location=1,' +
			'menubar=' + ( this.properties.HasMenubar ? '1' : '0' ) + ',' +
			'resizable=1,' +
			'status=1,' +
			'scrollbars=1,' +
			'toolbar=' + ( this.properties.HasToolbar ? '1' : '0' );

		var href = null;
		this.item.links.forEach(function(l) {
			if (l.rel.indexOf('self') > -1) {
				href = l.href;
			}
		});

		// name can't contain non-alphanumerics
		var windowName = href.replace(/[^a-zA-Z0-9]+/g,'_');

		var w = window.open(href, windowName, features);
		if (w) {
			w.focus();
		}

	},
	onClickAction: function() {

		var frm = document.createElement('form');
		frm.setAttribute('target', '_top');
		frm.setAttribute('action', this.item.href);
		frm.setAttribute('method', this.item.method);
		frm.setAttribute('enctype', this.item.type)

		this.item.fields.forEach(function(f) {
			if (f.type === 'hidden') {
				var hidden = document.createElement('input');
				hidden.setAttribute('type', 'hidden');
				hidden.setAttribute('name', f.name)
				hidden.setAttribute('value', f.value);
				frm.appendChild(hidden);
			}
		})

		document.body.appendChild(frm);
		frm.submit();

		// special handling for logout
		if (this.item.class.indexOf('logout') > -1) {
			try {
				window.localStorage.setItem('Session.Expired', '1');
			} catch(e) {
				// no access to local storage, whateves
			}
		}

	}
};

window.D2L = window.D2L || {};
window.D2L.PolymerBehaviors = window.D2L.PolymerBehaviors || {};
/** @polymerBehavior */
window.D2L.PolymerBehaviors.NavigationItemBehavior = [NavigationItemBehavior]
})();
</script>
