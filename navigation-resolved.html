<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="header/header.html">
<link rel="import" href="mobile/menu.html">
<link rel="import" href="navigation-main.html">
<dom-module id="d2l-navigation-resolved">
	<style include="d2l-colors">
		:host {
			background-color: #fff;
			display: block;
			line-height: 1;
			min-width: 320px;
		}
		@media(max-width: 992px) {
			d2l-navigation-main {
				display: none;
			}
		}
	</style>
	<template>
		<nav>
			<d2l-navigation-header
				admin-menu-location="[[adminMenuLocation]]"
				course-menu-location="[[courseMenuLocation]]"
				logo="[[logo]]"
				logo-href="[[logoHref]]"
				logo-text="[[logoText]]"
				notifications="[[notifications]]"
				my-home="[[myHome]]"
				org-unit-home="[[orgUnitHome]]"
				org-unit-name="[[orgUnitName]]"
				user-href="[[userHref]]"
				personal-menu-location="[[personalMenuLocation]]"></d2l-navigation-header>
			<d2l-navigation-main
				items="[[items]]"></d2l-navigation-main>
			<d2l-navigation-mobile-menu
				band-color="[[bandColor]]"
				items="[[items]]"
				logo="[[logo]]"
				logo-href="[[logoHref]]"
				logo-text="[[logoText]]"
				my-home="[[myHome]]"
				org-unit-home="[[orgUnitHome]]"
				org-unit-name="[[orgUnitName]]"></d2l-navigation-mobile-menu>
			<d2l-navigation-main
				aria-hidden
				role$="presentation"
				items="[[items]]" debugging></d2l-navigation-main>
		</nav>
	</template>
</dom-module>
<script>
	Polymer({
		is: 'd2l-navigation-resolved',
		properties: {
			adminMenuLocation: String,
			bandColor: String,
			courseMenuLocation: String,
			hasAdminMenu: {
				reflectToAttribute: true,
				type: Boolean,
				value: false
			},
			items: Array,
			logo: String,
			logoHref: String,
			logoText: String,
			myHome: String,
			notifications: Array,
			orgUnitHome: String,
			orgUnitName: String,
			userHref: String,
			personalMenuLocation: String,
			_navMainViewable: Object,
			_navMainHidden: Object
		},
		listeners: {
			'd2l-navigation-open-menu': 'openMenu',
			'_focus': '_handleFocus',
			'd2l-navigation-main-items-available': '_handleItemsAvailable'
		},
		ready: function() {
			this._navMainViewable = this.$$('d2l-navigation-main:not([aria-hidden])');
			this._navMainHidden = this.$$('d2l-navigation-main[aria-hidden]');
			window.addEventListener('resize', this._chompMainNav.bind(this), true);
		},
		openMenu: function(e) {
			this.$$('d2l-navigation-mobile-menu').open(e.detail.opener);
		},
		_handleFocus: function() {
			this._navMainViewable.scrollTop = 0;
		},
		_handleItemsAvailable: function() {
			if (this._navMainViewable.getItemCount() && this._navMainHidden.getItemCount()) {
				var me = this;
				setTimeout(function() {
					me._chompMainNav();
				}, 10);
			}
		},
		_chompMainNav: function() {
			var mainViewable = this._navMainViewable,
				mainHidden = this._navMainHidden;

			mainHidden.hiddenChomp();
			mainViewable.showStartingItems(mainHidden.getItemsShowingCount());

			if (mainHidden.getIsMoreGroupShowing()) {
				Polymer.dom(mainViewable).node.setAttribute('justify-space-between', 'true');
				mainViewable.showMainGroup();
			} else {
				mainViewable.hideMainGroup();
				Polymer.dom(mainViewable).node.removeAttribute('justify-space-between');
			}
		}
	});
</script>
