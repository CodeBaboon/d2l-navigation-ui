<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../vui-colors/colors.html">
<dom-module id="d2l-navigation-page-load-progress">
	<style include="vui-colors">
		:host {
			background-color: var(--vui-color-woolonardo);
			display: block;
		}
		:host > div {
			background-color: var(--vui-color-pressicus);
			transition: background-color 300ms;
			width: 0;
		}
		:host, :host > div {
			height: 4px;
		}
		.d2l-navigation-page-load-progress-fast {
			transition: width 300ms ease-in;
		}
		.d2l-navigation-page-load-progress-slow {
			transition: width 10s cubic-bezier(.16,1,.4,1);
		}
	</style>
	<template>
		<div></div>
	</template>
</dom-module>
<script>
	Polymer({
		is: 'd2l-navigation-page-load-progress',
		properties: {
			color: {
				type: String,
				observer: '_colorChanged',
				reflectToAttribute: true,
				value: '#b9c2d0'
			},
			_inProgress: {
				type: Boolean,
				value: false
			}
		},
		_colorChanged: function(newValue) {
			this.$$('div').style.backgroundColor = newValue;
		},
		_toggle: function(slow, fast, width) {
			var div = this.$$('div');
			this.toggleClass(
					'd2l-navigation-page-load-progress-slow',
					slow,
					div
				);
			this.toggleClass(
					'd2l-navigation-page-load-progress-fast',
					fast,
					div
				);
			if (width) {
				div.style.width = width;
			}
		},
		finish: function() {
			this._toggle(false, true, '100%');
		},
		start: function() {

			var div = this.$$('div');

			this._toggle(false, false, '0%');

			if (this._inProgress) {
				this._inProgress = false;
				this.async(this.start, 100);
				return;
			}

			this._toggle(true, false);
			this._inProgress = true;
			this.async(function() {
				if (this._inProgress) {
					div.style.width = '99%';
				}
			}.bind(this), 100);

		}
	});
</script>
