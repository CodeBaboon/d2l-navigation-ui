<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../vui-colors/colors.html">
<dom-module id="d2l-navigation-item-link">
	<style include="vui-colors">
		:host {
			cursor: pointer;
			display: inline-block;
			padding: 20px 30px 20px 0;
		}
		:host-context(d2l-navigation-slide-out-menu) {
			border-bottom: 1px solid var(--vui-color-gypsum);
			display: block;
			padding: 20px;
		}
		:host > a, :host > a:link, :host > a:visited {
			color: var(--vui-color-ferrite);
			text-decoration: none;
		}
		:host > a:hover, :host > a:focus {
			color: var(--vui-color-carnelian);
			text-decoration: underline;
			outline: none;
		}
	</style>
	<template>
		<a href$="{{href}}" on-tap="onClick" tabindex="0">{{text}}</a>
	</template>
</dom-module>
<script>
	Polymer({
		is: 'd2l-navigation-item-link',
		properties: {
			item: Object,
			href: {
				type: String,
				computed: 'getHref(item)'
			},
			text: {
				type: String,
				computed: 'getText(item)'
			}
		},
		hostAttributes: {
			role: 'listitem'
		},
		getHref: function(item) {
			var href = undefined;
			if (item.class.indexOf('item') > -1) {
				if (item.class.indexOf('link') > -1) {
					item.links.forEach(function(l) {
						if (l.rel.indexOf('self') > -1) {
							href = l.href;
						}
					});
				}
			}
			return href;
		},
		getText: function(item) {
			if (this.item.class.indexOf('item') > -1) {
				return item.properties.text;
			} else if (this.item.class.indexOf('action') > -1) {
				return this.item.title;
			}
		},
		onClick: function() {

			if (this.item.class.indexOf('action') < 0) {
				return;
			}

			var frm = document.createElement('form');
			frm.setAttribute('target', '_top');
			frm.setAttribute('action', this.item.href);
			frm.setAttribute('method', this.item.method);
			frm.setAttribute('enctype', this.item.type)

			this.item.fields.forEach(function(f) {
				if (f.type === 'hidden') {
					var hidden = document.createElement('input');
					hidden.setAttribute('type', 'hidden');
					hidden.setAttribute('name', f.name)
					hidden.setAttribute('value', f.value);
					frm.appendChild(hidden);
				}
			})

			document.body.appendChild(frm);
			frm.submit();

			// special handling for logout
			if (this.item.class.indexOf('logout') > -1) {
				try {
					window.localStorage.setItem('Session.Expired', '1');
				} catch(e) {
					// no access to local storage, whateves
				}
			}

		}
	});
</script>
